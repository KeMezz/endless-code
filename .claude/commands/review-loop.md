# Review Loop Command

PR ì¸ë¼ì¸ ë¦¬ë·° ë£¨í”„ë¥¼ ìë™ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤. ralph-loop ìŠ¤íƒ€ì¼ë¡œ stop hookì„ í†µí•´ ìë™ ë°˜ë³µë©ë‹ˆë‹¤.

## ì¸ì

- `$ARGUMENTS`: PR ë²ˆí˜¸ (ì„ íƒ). ì—†ìœ¼ë©´ í˜„ì¬ ë¸Œëœì¹˜ì˜ PR ìë™ ê°ì§€. `--max-iterations N` ì˜µì…˜ ì§€ì›.

---

## ì´ˆê¸°í™”

### 1. ì¸ì íŒŒì‹±

```bash
# ê¸°ë³¸ê°’
MAX_ITERATIONS=10
PR_NUMBER=""

# ì¸ì íŒŒì‹±
for arg in $ARGUMENTS; do
  if [[ "$prev_arg" == "--max-iterations" ]]; then
    MAX_ITERATIONS="$arg"
    prev_arg=""
  elif [[ "$arg" == "--max-iterations" ]]; then
    prev_arg="$arg"
  elif [[ "$arg" =~ ^[0-9]+$ ]]; then
    PR_NUMBER="$arg"
  fi
done
```

### 2. PR ë° Repo ì •ë³´ í™•ì¸

```bash
# PR ì •ë³´
gh pr view ${PR_NUMBER} --json number,url,title,state,headRefName

# Repo ì •ë³´
gh repo view --json owner,name --jq '"\(.owner.login)/\(.name)"'
```

- PRì´ ì—†ê±°ë‚˜ closedë©´ ì¢…ë£Œ
- `OWNER/REPO`ì™€ `PR_NUMBER` ê¸°ë¡

### 3. ìƒíƒœ íŒŒì¼ ìƒì„±

`.claude/review-loop.local.md` íŒŒì¼ ìƒì„±:

```markdown
---
active: true
iteration: 1
max_iterations: {MAX_ITERATIONS}
pr_number: {PR_NUMBER}
owner_repo: {OWNER/REPO}
started_at: {ISO_TIMESTAMP}
---

PR #{PR_NUMBER} ë¦¬ë·° ë£¨í”„ ì§„í–‰ ì¤‘
```

### 4. ì´ˆê¸°í™” ë©”ì‹œì§€ ì¶œë ¥

```
ğŸ”„ Review Loop í™œì„±í™”!

PR: #{PR_NUMBER}
Iteration: 1 / {MAX_ITERATIONS}
Completion: ìƒˆ ë¦¬ë·° ì½”ë©˜íŠ¸ ì—†ìŒ ì‹œ ìë™ ì¢…ë£Œ

âš ï¸  ì´ ë£¨í”„ëŠ” ë¦¬ë·° ì½”ë©˜íŠ¸ê°€ ì—†ê±°ë‚˜ max-iterationsì— ë„ë‹¬í•  ë•Œê¹Œì§€ ê³„ì†ë©ë‹ˆë‹¤.
```

---

## ì‹¤í–‰ ì§€ì¹¨

### 1. ìƒíƒœ íŒŒì¼ ì½ê¸°

`.claude/review-loop.local.md`ì—ì„œ í˜„ì¬ iteration, PR ì •ë³´ í™•ì¸.

### 2. ë¦¬ë·° ìš”ì²­

```bash
gh pr comment <PR_NUMBER> --body "@claude ë¦¬ë·°"
```

ìš”ì²­ ì½”ë©˜íŠ¸ ID ì €ì¥ (ë‚˜ì¤‘ì— ì‚­ì œìš©).

### 3. ë¦¬ë·° ì™„ë£Œ ëŒ€ê¸°

AskUserQuestionìœ¼ë¡œ ì„ íƒì§€ ì œê³µ:
- **ë¦¬ë·° ì™„ë£Œ**: Claude ë¦¬ë·°ê°€ ì™„ë£Œë¨, ì²˜ë¦¬ ì‹œì‘
- **ì¤‘ë‹¨**: ë£¨í”„ ì¢…ë£Œ

### 4. "@claude ë¦¬ë·°" ì½”ë©˜íŠ¸ ì‚­ì œ

ë¦¬ë·° ìš”ì²­ ì½”ë©˜íŠ¸ ì‚­ì œ:

```bash
gh api -X DELETE repos/<OWNER>/<REPO>/issues/comments/<REQUEST_COMMENT_ID>
```

### 5. ë¦¬ë·° ì½”ë©˜íŠ¸ ìˆ˜ì§‘ (Unresolvedë§Œ)

#### 5.1 ì¸ë¼ì¸ ì½”ë©˜íŠ¸ (ë¯¸í•´ê²° ìŠ¤ë ˆë“œë§Œ)

GraphQLë¡œ ë¯¸í•´ê²° ë¦¬ë·° ìŠ¤ë ˆë“œë§Œ ìˆ˜ì§‘:

```bash
gh api graphql -f query='
query($owner: String!, $repo: String!, $pr: Int!) {
  repository(owner: $owner, name: $repo) {
    pullRequest(number: $pr) {
      reviewThreads(first: 100) {
        nodes {
          isResolved
          id
          comments(first: 10) {
            nodes {
              id
              databaseId
              author { login }
              body
              path
              line
              createdAt
            }
          }
        }
      }
    }
  }
}' -f owner="<OWNER>" -f repo="<REPO>" -F pr=<PR_NUMBER> \
  --jq '.data.repository.pullRequest.reviewThreads.nodes
    | map(select(.isResolved == false))
    | map({
        threadId: .id,
        comments: .comments.nodes | map(select(.author.login == "github-actions" or .author.login == "claude-bot" or .author.login == "copilot")) | map({
          id: .databaseId,
          path: .path,
          line: .line,
          body: .body,
          created_at: .createdAt
        })
      })
    | map(select(.comments | length > 0))'
```

#### 5.2 ì¼ë°˜ ì½”ë©˜íŠ¸ (Bot ì‘ì„±)

```bash
gh api repos/<OWNER>/<REPO>/issues/<PR_NUMBER>/comments \
  --jq '[.[] | select(.user.type == "Bot" or .user.login == "github-actions[bot]" or .user.login == "claude[bot]") | {
    type: "general",
    id: .id,
    body: .body,
    created_at: .created_at
  }] | sort_by(.created_at) | reverse | .[0:5]'
```

**ìƒˆ ì½”ë©˜íŠ¸ ì—†ìœ¼ë©´** â†’ ì¢…ë£Œ ì¡°ê±´ ì¶©ì¡±

### 6. ì¢…ë£Œ ì¡°ê±´ í™•ì¸

ìƒˆ ë¯¸í•´ê²° ì½”ë©˜íŠ¸ê°€ ì—†ìœ¼ë©´:

```
âœ… ëª¨ë“  ë¦¬ë·° ì½”ë©˜íŠ¸ ì²˜ë¦¬ ì™„ë£Œ!

<promise>ë¦¬ë·° ì™„ë£Œ</promise>
```

ìƒíƒœ íŒŒì¼ì—ì„œ `active: false`ë¡œ ì—…ë°ì´íŠ¸.

### 7. ê° ì½”ë©˜íŠ¸ ì²˜ë¦¬

ì½”ë©˜íŠ¸ typeì— ë”°ë¼ ì²˜ë¦¬:

#### 7.1 ì‹¬ê°ë„ íŒŒì•…

ì½”ë©˜íŠ¸ bodyì—ì„œ ì‹¬ê°ë„ ì´ëª¨ì§€ í™•ì¸:
- ğŸ”´ **Critical**: ë°˜ë“œì‹œ ìˆ˜ì •
- ğŸŸ¡ **Warning**: ìˆ˜ì • ê¶Œì¥
- ğŸŸ¢ **Suggestion**: ì„ íƒì 

#### 7.2 Suggestion ë¸”ë¡ í™•ì¸

```markdown
```suggestion
ìˆ˜ì •ëœ ì½”ë“œ
```
```

ìˆìœ¼ë©´ í•´ë‹¹ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì ìš©.

#### 7.3 ìˆ˜ì • ê²°ì •

| ì‹¬ê°ë„ | ê¸°ë³¸ í–‰ë™ |
|--------|----------|
| ğŸ”´ Critical | ACCEPT (ìˆ˜ì •) |
| ğŸŸ¡ Warning | ê²€í†  í›„ ê²°ì • |
| ğŸŸ¢ Suggestion | íƒ€ë‹¹í•˜ë©´ ACCEPT, ì•„ë‹ˆë©´ REJECT |

#### 7.4 ACCEPT: ì½”ë“œ ìˆ˜ì • + ìŠ¤ë ˆë“œ Resolve

**ì¸ë¼ì¸ ì½”ë©˜íŠ¸**:
1. íŒŒì¼ ì½ê¸° ë° ìˆ˜ì •
2. ìŠ¤í…Œì´ì§•: `git add <path>`
3. ë‹µê¸€ ì‘ì„±:
   ```bash
   gh api repos/<OWNER>/<REPO>/pulls/comments/<COMMENT_ID>/replies \
     -f body="âœ… ìˆ˜ì • ì™„ë£Œ"
   ```
4. **ìŠ¤ë ˆë“œ Resolve**:
   ```bash
   gh api graphql -f query='
   mutation($threadId: ID!) {
     resolveReviewThread(input: {threadId: $threadId}) {
       thread { isResolved }
     }
   }' -f threadId="<THREAD_ID>"
   ```

**ì¼ë°˜ ì½”ë©˜íŠ¸**:
1. ì½”ë©˜íŠ¸ì—ì„œ ì–¸ê¸‰ëœ íŒŒì¼/íŒ¨í„´ íŒŒì•…
2. í•´ë‹¹ íŒŒì¼ë“¤ ìˆ˜ì •
3. ë¦¬ì•¡ì…˜ ì¶”ê°€:
   ```bash
   gh api repos/<OWNER>/<REPO>/issues/comments/<COMMENT_ID>/reactions \
     -f content="+1"
   ```

#### 7.5 REJECT: ì´ìœ  ì„¤ëª… + ìŠ¤ë ˆë“œ Resolve

**ì¸ë¼ì¸ ì½”ë©˜íŠ¸**:
```bash
# ë‹µê¸€
gh api repos/<OWNER>/<REPO>/pulls/comments/<COMMENT_ID>/replies \
  -f body="í˜„ì¬ êµ¬í˜„ì„ ìœ ì§€í•©ë‹ˆë‹¤.

**ì´ìœ **: <êµ¬ì²´ì  ì´ìœ >"

# ìŠ¤ë ˆë“œ Resolve (REJECTë„ ì²˜ë¦¬ ì™„ë£Œì´ë¯€ë¡œ)
gh api graphql -f query='
mutation($threadId: ID!) {
  resolveReviewThread(input: {threadId: $threadId}) {
    thread { isResolved }
  }
}' -f threadId="<THREAD_ID>"
```

**ì¼ë°˜ ì½”ë©˜íŠ¸**:
```bash
gh pr comment <PR_NUMBER> --body "ë‹¤ìŒ í”¼ë“œë°±ì— ëŒ€í•´ í˜„ì¬ êµ¬í˜„ì„ ìœ ì§€í•©ë‹ˆë‹¤:

> <ì›ë³¸ ì½”ë©˜íŠ¸ ìš”ì•½>

**ì´ìœ **: <êµ¬ì²´ì  ì´ìœ >"
```

### 8. ì»¤ë°‹ ë° í‘¸ì‹œ

ìˆ˜ì •ëœ íŒŒì¼ì´ ìˆìœ¼ë©´:

```bash
git commit -m "$(cat <<'EOF'
fix: ë¦¬ë·° ë°˜ì˜

- <íŒŒì¼1>: <ìˆ˜ì • ë‚´ìš©>
- <íŒŒì¼2>: <ìˆ˜ì • ë‚´ìš©>

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
EOF
)"

git push
```

### 9. Iteration ì—…ë°ì´íŠ¸

ìƒíƒœ íŒŒì¼ì˜ iteration ì¦ê°€:

```markdown
---
active: true
iteration: {N+1}
...
---
```

### 10. ë£¨í”„ ë°˜ë³µ

Step 2ë¡œ ëŒì•„ê°€ "@claude ë¦¬ë·°" ì¬ìš”ì²­.

Stop hookì´ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ iteration ì‹œì‘.

---

## ì¢…ë£Œ ì¡°ê±´

ë‹¤ìŒ ì¤‘ í•˜ë‚˜ ì¶©ì¡± ì‹œ `<promise>ë¦¬ë·° ì™„ë£Œ</promise>` ì¶œë ¥:

1. âœ… ìƒˆ ë¯¸í•´ê²° ë¦¬ë·° ì½”ë©˜íŠ¸ ì—†ìŒ
2. âš ï¸ max-iterations ë„ë‹¬
3. ğŸ›‘ ì‚¬ìš©ì "ì¤‘ë‹¨" ì„ íƒ
4. âš ï¸ ë™ì¼ íŒŒì¼/ë¼ì¸ ì½”ë©˜íŠ¸ 3íšŒ ë°˜ë³µ

---

## ìƒíƒœ íŒŒì¼ êµ¬ì¡°

`.claude/review-loop.local.md`:

```yaml
---
active: true
iteration: 3
max_iterations: 10
pr_number: 42
owner_repo: "user/repo"
started_at: "2024-01-15T10:30:00Z"
processed_comments: [123, 456, 789]
---

PR #42 ë¦¬ë·° ë£¨í”„ ì§„í–‰ ì¤‘
- Iteration 1: 3ê°œ ì½”ë©˜íŠ¸ ì²˜ë¦¬
- Iteration 2: 1ê°œ ì½”ë©˜íŠ¸ ì²˜ë¦¬
```

---

## ì²˜ë¦¬ íë¦„ ìš”ì•½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ìƒíƒœ íŒŒì¼ í™•ì¸/ìƒì„±                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. "@claude ë¦¬ë·°" ì½”ë©˜íŠ¸ ì‘ì„±                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ì‚¬ìš©ì ëŒ€ê¸° (ë¦¬ë·° ì™„ë£Œ / ì¤‘ë‹¨)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. "@claude ë¦¬ë·°" ì½”ë©˜íŠ¸ ì‚­ì œ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Unresolved ì½”ë©˜íŠ¸ ìˆ˜ì§‘ (GraphQL)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ ì½”ë©˜íŠ¸ ìˆìŒ?   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        No        â”‚        Yes
          â–¼       â”‚         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <promise>   â”‚   â”‚  â”‚  6. ê° ì½”ë©˜íŠ¸ ì²˜ë¦¬                    â”‚
â”‚ ë¦¬ë·° ì™„ë£Œ   â”‚   â”‚  â”‚     - ACCEPT: ìˆ˜ì • + Resolve         â”‚
â”‚ </promise>  â”‚   â”‚  â”‚     - REJECT: ë‹µê¸€ + Resolve         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                    â–¼
                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  â”‚  7. ì»¤ë°‹ & í‘¸ì‹œ                       â”‚
                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                    â–¼
                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  â”‚  8. Iteration++ â†’ Step 2ë¡œ ë°˜ë³µ      â”‚
                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ìµœì¢… ì¶œë ¥

```
## ë¦¬ë·° ë£¨í”„ ì™„ë£Œ

| í•­ëª© | ìˆ˜ |
|------|---|
| ì´ Iteration | N |
| ì²˜ë¦¬ëœ ì½”ë©˜íŠ¸ | M |
| ìˆ˜ì • ë°˜ì˜ (ACCEPT) | A |
| ìœ ì§€ (REJECT) | R |
| Resolved ìŠ¤ë ˆë“œ | S |
| ì»¤ë°‹ | C |

PR: <URL>

<promise>ë¦¬ë·° ì™„ë£Œ</promise>
```
